// Generated by BUCKLESCRIPT VERSION 4.0.5, PLEASE EDIT WITH CARE

import * as List from "bs-platform/lib/es6/list.js";
import * as Block from "bs-platform/lib/es6/block.js";
import * as Curry from "bs-platform/lib/es6/curry.js";
import * as Snabbdom_dom from "./snabbdom_dom.js";
import * as Snabbdom_base from "./snabbdom_base.js";
import * as Snabbdom_props from "./snabbdom_props.js";
import * as Snabbdom_vnode from "./snabbdom_vnode.js";
import * as Caml_exceptions from "bs-platform/lib/es6/caml_exceptions.js";
import * as Snabbdom_events from "./snabbdom_events.js";
import * as Snabbdom_simple_store from "./snabbdom_simple_store.js";
import * as Props from "snabbdom/modules/props";
import * as Eventlisteners from "snabbdom/modules/eventlisteners";

var patch = Snabbdom_base.init(/* array */[
      Props.default,
      Snabbdom_base.module_attributes,
      Eventlisteners.default,
      Snabbdom_base.module_style
    ]);

function many_items(_items, _i, max) {
  while(true) {
    var i = _i;
    var items = _items;
    if (i >= max) {
      return items;
    } else {
      _i = i + 1 | 0;
      _items = List.append(/* :: */[
            "Item " + String(i),
            /* [] */0
          ], items);
      continue ;
    }
  };
}

function checkbox(checked, onCheck, label_text) {
  var partial_arg_000 = Snabbdom_base.h("input", /* :: */[
        Snabbdom_events.change(onCheck),
        /* :: */[
          Snabbdom_props.prop("type", "checkbox"),
          /* :: */[
            Snabbdom_props.prop("checked", checked ? "checked" : ""),
            /* [] */0
          ]
        ]
      ]);
  var partial_arg_001 = /* :: */[
    Snabbdom_base.h("span", /* :: */[
          Snabbdom_base.style("font-weight", "bold"),
          /* :: */[
            (function (param) {
                return Snabbdom_base.text(label_text, param);
              }),
            /* [] */0
          ]
        ]),
    /* [] */0
  ];
  var partial_arg = /* :: */[
    partial_arg_000,
    partial_arg_001
  ];
  return Snabbdom_base.h("label", /* :: */[
              (function (param) {
                  return Snabbdom_base.children(partial_arg, param);
                }),
              /* [] */0
            ]);
}

function item(store, s) {
  var del = function () {
    return Snabbdom_simple_store.dispatch(store, /* Delete */Block.__(1, [s]));
  };
  var partial_arg_000 = Snabbdom_base.h("a", /* :: */[
        Snabbdom_props.prop("href", "javascript:;"),
        /* :: */[
          Snabbdom_events.mousemove(del),
          /* :: */[
            (function (param) {
                return Snabbdom_base.text(s, param);
              }),
            /* [] */0
          ]
        ]
      ]);
  var partial_arg = /* :: */[
    partial_arg_000,
    /* [] */0
  ];
  var partial_arg_000$1 = Snabbdom_base.h("td", /* :: */[
        (function (param) {
            return Snabbdom_base.children(partial_arg, param);
          }),
        /* [] */0
      ]);
  var partial_arg$1 = /* :: */[
    partial_arg_000$1,
    /* [] */0
  ];
  return Snabbdom_base.h("tr", /* :: */[
              (function (param) {
                  return Snabbdom_base.key(s, param);
                }),
              /* :: */[
                Snabbdom_base.style("line-height", "0"),
                /* :: */[
                  Snabbdom_base.style("opacity", "1"),
                  /* :: */[
                    Snabbdom_base.style("transition", "line-height 0.3s, opacity 0.3s"),
                    /* :: */[
                      Snabbdom_base.style_delayed("line-height", "1"),
                      /* :: */[
                        Snabbdom_base.style_remove("line-height", "0"),
                        /* :: */[
                          Snabbdom_base.style_remove("opacity", "0"),
                          /* :: */[
                            (function (param) {
                                return Snabbdom_base.children(partial_arg$1, param);
                              }),
                            /* [] */0
                          ]
                        ]
                      ]
                    ]
                  ]
                ]
              ]
            ]);
}

function view(store) {
  var state = Snabbdom_simple_store.get_state(store);
  var cb = function (action, ev) {
    Snabbdom_dom.prevent_default(ev);
    Snabbdom_dom.stop_propagation(ev);
    return Snabbdom_simple_store.dispatch(store, action);
  };
  var onChange = function (ev) {
    return Snabbdom_events.next_tick((function () {
                  var value = Snabbdom_dom.get_value(Snabbdom_dom.get_target(ev));
                  return Snabbdom_simple_store.dispatch(store, /* SetText */Block.__(0, [value]));
                }));
  };
  var onCheck = function (ev) {
    var value = Snabbdom_dom.is_checked(Snabbdom_dom.get_target(ev));
    return Snabbdom_simple_store.dispatch(store, /* ToggleShow */Block.__(2, [value]));
  };
  var partial_arg = "Count: " + String(state[/* count */0]);
  var partial_arg_000 = Snabbdom_base.h("strong", /* :: */[
        (function (param) {
            return Snabbdom_base.text("bs-snabbdom", param);
          }),
        /* [] */0
      ]);
  var partial_arg$1 = /* :: */[
    partial_arg_000,
    /* [] */0
  ];
  var partial_arg$2 = state[/* name */1];
  var partial_arg_000$1 = Snabbdom_base.h("em", /* :: */[
        (function (param) {
            return Snabbdom_base.text(partial_arg$2, param);
          }),
        /* [] */0
      ]);
  var partial_arg$3 = /* :: */[
    partial_arg_000$1,
    /* [] */0
  ];
  var partial_arg_000$2 = Snabbdom_base.h("input", /* :: */[
        Snabbdom_events.keydown(onChange),
        /* :: */[
          Snabbdom_props.prop("placeholder", "Type something, click Add"),
          /* :: */[
            Snabbdom_props.prop("value", state[/* name */1]),
            /* [] */0
          ]
        ]
      ]);
  var partial_arg_001 = /* :: */[
    Snabbdom_base.h("button", /* :: */[
          Snabbdom_events.click((function (param) {
                  return cb(/* AddItem */2, param);
                })),
          /* :: */[
            (function (param) {
                return Snabbdom_base.text("Add", param);
              }),
            /* [] */0
          ]
        ]),
    /* [] */0
  ];
  var partial_arg$4 = /* :: */[
    partial_arg_000$2,
    partial_arg_001
  ];
  var partial_arg_000$3 = Snabbdom_base.h("circle", /* :: */[
        Snabbdom_base.attr("cx", "50"),
        /* :: */[
          Snabbdom_base.attr("cy", "50"),
          /* :: */[
            Snabbdom_base.attr("r", "30"),
            /* :: */[
              Snabbdom_base.attr("fill", "#000"),
              /* [] */0
            ]
          ]
        ]
      ]);
  var partial_arg$5 = /* :: */[
    partial_arg_000$3,
    /* [] */0
  ];
  var partial_arg_000$4 = Snabbdom_base.h("h1", /* :: */[
        (function (param) {
            return Snabbdom_base.text(partial_arg, param);
          }),
        /* [] */0
      ]);
  var partial_arg_001$1 = /* :: */[
    Snabbdom_base.h("button", /* :: */[
          Snabbdom_events.click((function (param) {
                  return cb(/* Increment */0, param);
                })),
          /* :: */[
            (function (param) {
                return Snabbdom_base.text("+", param);
              }),
            /* [] */0
          ]
        ]),
    /* :: */[
      Snabbdom_base.h("button", /* :: */[
            Snabbdom_events.click((function (param) {
                    return cb(/* Decrement */1, param);
                  })),
            /* :: */[
              (function (param) {
                  return Snabbdom_base.text("-", param);
                }),
              /* [] */0
            ]
          ]),
      /* :: */[
        Snabbdom_base.h("p", /* :: */[
              (function (param) {
                  return Snabbdom_base.children(partial_arg$1, param);
                }),
              /* :: */[
                (function (param) {
                    return Snabbdom_base.text(" demo. ", param);
                  }),
                /* :: */[
                  (function (param) {
                      return Snabbdom_base.children(partial_arg$3, param);
                    }),
                  /* [] */0
                ]
              ]
            ]),
        /* :: */[
          Snabbdom_base.h("div", /* :: */[
                (function (param) {
                    return Snabbdom_base.children(partial_arg$4, param);
                  }),
                /* [] */0
              ]),
          /* :: */[
            checkbox(state[/* show_items */3], onCheck, "Show item list"),
            /* :: */[
              Snabbdom_base.h("svg", /* :: */[
                    Snabbdom_base.attr("width", "200"),
                    /* :: */[
                      Snabbdom_base.attr("height", "200"),
                      /* :: */[
                        (function (param) {
                            return Snabbdom_base.children(partial_arg$5, param);
                          }),
                        /* [] */0
                      ]
                    ]
                  ]),
              /* [] */0
            ]
          ]
        ]
      ]
    ]
  ];
  var partial_arg$6 = /* :: */[
    partial_arg_000$4,
    partial_arg_001$1
  ];
  var tmp;
  if (state[/* show_items */3]) {
    var partial_arg_000$5 = Snabbdom_base.h("td", /* :: */[
          (function (param) {
              return Snabbdom_base.text("Mouse over to delete", param);
            }),
          /* [] */0
        ]);
    var partial_arg$7 = /* :: */[
      partial_arg_000$5,
      /* [] */0
    ];
    var partial_arg_000$6 = Snabbdom_base.h("tr", /* :: */[
          (function (param) {
              return Snabbdom_base.children(partial_arg$7, param);
            }),
          /* [] */0
        ]);
    var partial_arg$8 = /* :: */[
      partial_arg_000$6,
      /* [] */0
    ];
    var partial_arg$9 = List.map((function (param) {
            return item(store, param);
          }), state[/* items */2]);
    var partial_arg_000$7 = Snabbdom_base.h("table", /* :: */[
          (function (param) {
              return Snabbdom_base.children(partial_arg$8, param);
            }),
          /* :: */[
            Snabbdom_props.prop("border", "1"),
            /* :: */[
              (function (param) {
                  return Snabbdom_base.children(partial_arg$9, param);
                }),
              /* [] */0
            ]
          ]
        ]);
    var partial_arg$10 = /* :: */[
      partial_arg_000$7,
      /* [] */0
    ];
    tmp = (function (param) {
        return Snabbdom_base.children(partial_arg$10, param);
      });
  } else {
    tmp = Snabbdom_base.nothing;
  }
  return Snabbdom_base.h("div", /* :: */[
              (function (param) {
                  return Snabbdom_base.children(partial_arg$6, param);
                }),
              /* :: */[
                tmp,
                /* [] */0
              ]
            ]);
}

var No_root_element = Caml_exceptions.create("Snabbdom_demo.No_root_element");

var vnode = /* record */[/* contents */Snabbdom_vnode.from_dom_id("app")];

function reducer(state, action) {
  if (typeof action === "number") {
    switch (action) {
      case 0 : 
          return /* record */[
                  /* count */state[/* count */0] + 1 | 0,
                  /* name */state[/* name */1],
                  /* items */state[/* items */2],
                  /* show_items */state[/* show_items */3]
                ];
      case 1 : 
          return /* record */[
                  /* count */state[/* count */0] - 1 | 0,
                  /* name */state[/* name */1],
                  /* items */state[/* items */2],
                  /* show_items */state[/* show_items */3]
                ];
      case 2 : 
          var item_name = state[/* name */1] + (": " + String(state[/* count */0]));
          return /* record */[
                  /* count */state[/* count */0],
                  /* name */"",
                  /* items */List.append(/* :: */[
                        item_name,
                        /* [] */0
                      ], state[/* items */2]),
                  /* show_items */state[/* show_items */3]
                ];
      
    }
  } else {
    switch (action.tag | 0) {
      case 0 : 
          return /* record */[
                  /* count */state[/* count */0],
                  /* name */action[0],
                  /* items */state[/* items */2],
                  /* show_items */state[/* show_items */3]
                ];
      case 1 : 
          var s = action[0];
          var no_name_match = function (item) {
            return item !== s;
          };
          return /* record */[
                  /* count */state[/* count */0],
                  /* name */state[/* name */1],
                  /* items */List.filter(no_name_match)(state[/* items */2]),
                  /* show_items */state[/* show_items */3]
                ];
      case 2 : 
          return /* record */[
                  /* count */state[/* count */0],
                  /* name */state[/* name */1],
                  /* items */state[/* items */2],
                  /* show_items */action[0]
                ];
      
    }
  }
}

function logging_middleware(store, next, action) {
  console.log("Action:");
  console.log(action);
  Curry._1(next, action);
  console.log("New state:");
  console.log(Snabbdom_simple_store.get_state(store));
  return /* () */0;
}

function render(view, store) {
  var newVnode = Curry._1(view, store);
  Curry._2(patch, vnode[0], newVnode);
  vnode[0] = newVnode;
  return /* () */0;
}

function main() {
  var store = Snabbdom_simple_store.create_store_with_middleware(/* record */[
        /* count */0,
        /* name */"",
        /* items */many_items(/* [] */0, 0, 500),
        /* show_items */false
      ], reducer, logging_middleware);
  Snabbdom_simple_store.on_change(store, (function (param) {
          return render(view, param);
        }));
  render(view, store);
  return /* () */0;
}

main(/* () */0);

var Store = 0;

export {
  Store ,
  patch ,
  many_items ,
  checkbox ,
  item ,
  view ,
  No_root_element ,
  vnode ,
  reducer ,
  logging_middleware ,
  render ,
  main ,
  
}
/* patch Not a pure module */
